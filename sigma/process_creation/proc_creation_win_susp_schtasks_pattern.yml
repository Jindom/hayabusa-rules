
title: Suspicious Add Scheduled Command Pattern
author: Florian Roth
date: 2022/02/23
description: Detects suspicious scheduled task creations with commands that are uncommon
detection:
  SELECTION_1:
    Image: '*schtasks.exe'
  SELECTION_2:
    CommandLine: '*/Create *'
  SELECTION_3:
    CommandLine:
    - '*/sc minute *'
    - '*/ru system *'
  SELECTION_4:
    CommandLine:
    - '*cmd.exe /c *'
    - '*cmd /c*'
    - '* -w hidden *'
    - '* bypass *'
    - '* IEX*'
    - '* -enc *'
    - '* -decode *'
    - '*.DownloadString*'
    - '*.DownloadFile*'
    - '*FromBase64String*'
  SELECTION_5:
    CommandLine: '*/xml C:\Users\\*'
  SELECTION_6:
    CommandLine: '*\AppData\Local\\*'
  SELECTION_7:
    CommandLine: '*wscript.exe*'
  SELECTION_8:
    CommandLine: '*\AppData\\*'
  condition: ((SELECTION_1 and SELECTION_2) and ((SELECTION_3 and SELECTION_4) or
    ((SELECTION_5 and SELECTION_6) or (SELECTION_7 and SELECTION_8))))
falsepositives:
- Software installers that run from temporary folders and also install scheduled tasks
id: f2c64357-b1d2-41b7-849f-34d2682c0fad
level: high
logsource:
  category: process_creation
  product: windows
references:
- https://app.any.run/tasks/512c1352-6380-4436-b27d-bb62f0c020d6/
status: experimental
tags:
- attack.execution
- attack.t1053.005
